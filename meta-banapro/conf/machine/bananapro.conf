# Yocto machine configuration for Banana Pro (Allwinner A20)

require conf/machine/include/sun7i.inc

MACHINEOVERRIDES =. "bananapro:bananapi:a20:"

# Force open-source Mesa stack for Wayland/GBM
PREFERRED_PROVIDER_virtual/libgl = "mesa"
PREFERRED_PROVIDER_virtual/mesa = "mesa"
PREFERRED_PROVIDER_virtual/libgles1 = "mesa"
PREFERRED_PROVIDER_virtual/libgles2 = "mesa"
PREFERRED_PROVIDER_virtual/egl = "mesa"

SERIAL_CONSOLE = "115200 ttyS0"

PREFERRED_PROVIDER_virtual/kernel ?= "linux-mainline"
PREFERRED_PROVIDER_virtual/bootloader ?= "u-boot"

KERNEL_DEVICETREE = "allwinner/sun7i-a20-bananapro.dtb"

IMAGE_BOOT_FILES:append = " bpi-m1p-lcd.dtbo;overlays/bpi-m1p-lcd.dtbo"
KERNEL_DTC_FLAGS:append = " -@"

UBOOT_CONFIG ??= "bananapro"
UBOOT_CONFIG[bananapro] = "Bananapro_defconfig"

MACHINE_FEATURES += "wifi bluetooth screen"

# Drop Mali binary blobs added by the common sunxi include
XSERVER:remove = "sunxi-mali sunxi-mali-dev"
MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS:remove = "kernel-module-mali kernel-module-mali-drm"
